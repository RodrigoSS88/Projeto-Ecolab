# -*- coding: utf-8 -*-
"""c-pia-de-imers-o-ia-alura-google-gemini-aula-05-agentes.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/gist/RodrigoSS88/bd28aabb3b90264d2246821c98765f6d/c-pia-de-imers-o-ia-alura-google-gemini-aula-05-agentes.ipynb
"""

# Commented out IPython magic to ensure Python compatibility.
# %pip -q install google-genai

# Commented out IPython magic to ensure Python compatibility.
# %pip -q install googlemaps

def definir_objetivo():
    """
    Fun√ß√£o para definir o prop√≥sito do chatbot.

    Esta fun√ß√£o guia o usu√°rio atrav√©s de uma s√©rie de perguntas para
    determinar o objetivo principal do chatbot. As op√ß√µes incluem:
    - Atendimento ao cliente
    - Assistente virtual
    - Gera√ß√£o de leads
    """
    print("Passo 1: Defini√ß√£o do Objetivo do Chatbot")
    print("Qual ser√° a fun√ß√£o principal do seu chatbot?")

    opcoes = {
        "1": "Atendimento ao cliente (tirar d√∫vidas, resolver problemas)",
        "2": "Assistente virtual (agendar compromissos, fornecer informa√ß√µes)",
        "3": "Gera√ß√£o de leads (coletar informa√ß√µes de contato, qualificar clientes)",

    }

    for chave, valor in opcoes.items():
        print(f"{chave}. {valor}")

    while True:
        escolha = input("Digite o n√∫mero da op√ß√£o desejada: ")
        if escolha in opcoes:
            return opcoes[escolha]
        else:
            print("Op√ß√£o inv√°lida. Por favor, digite um n√∫mero v√°lido.")

def detalhar_objetivo(objetivo):
    """
    Fun√ß√£o para detalhar o objetivo escolhido.

    Esta fun√ß√£o fornece mais detalhes e exemplos espec√≠ficos para o
    objetivo selecionado pelo usu√°rio.

    Args:
        objetivo (str): O objetivo principal do chatbot.
    """
    print(f"\nVoc√™ escolheu: {objetivo}")
    print("Por favor, forne√ßa mais detalhes sobre como o chatbot ir√° realizar este objetivo:")

    if objetivo == "Atendimento ao cliente (tirar d√∫vidas, resolver problemas)":
        print("Exemplos de como o chatbot pode ser usado para atendimento ao cliente:")
        print("- Esclarecer d√∫vidas frequentes sobre produtos ou servi√ßos.")
        print("- Fornecer suporte t√©cnico b√°sico.")
        print("- Auxiliar na resolu√ß√£o de problemas e reclama√ß√µes.")
        print("- Redirecionar para atendentes humanos quando necess√°rio.")
    elif objetivo == "Assistente virtual (agendar compromissos, fornecer informa√ß√µes)":
        print("Exemplos de como o chatbot pode ser usado como assistente virtual:")
        print("- Agendar e confirmar compromissos e reservas.")
        print("- Fornecer informa√ß√µes sobre hor√°rios, locais e disponibilidade.")
        print("- Enviar lembretes e notifica√ß√µes.")
        print("- Integrar com calend√°rios e outros sistemas.")
    elif objetivo == "Gera√ß√£o de leads (coletar informa√ß√µes de contato, qualificar clientes)":
        print("Exemplos de como o chatbot pode ser usado para gera√ß√£o de leads:")
        print("- Coletar informa√ß√µes de contato de potenciais clientes.")
        print("- Qualificar leads atrav√©s de perguntas e intera√ß√µes.")
        print("- Direcionar leads qualificados para a equipe de vendas.")
        print("- Integrar com sistemas de CRM.")


    detalhes = input("Digite seus detalhes aqui: ")
    return detalhes #Retorna os detalhes do objetivo

def definir_publico_alvo():
    """
    Fun√ß√£o para definir o p√∫blico-alvo do chatbot.

    Esta fun√ß√£o coleta informa√ß√µes sobre o p√∫blico que ir√° interagir
    com o chatbot, incluindo perfil demogr√°fico, necessidades e
    expectativas, e linguagem e tom de voz adequados.
    """
    print("\nPasso 2: Defini√ß√£o do P√∫blico-alvo")
    print("Para quem este chatbot est√° sendo desenvolvido?")

    perfil_demografico = input("Digite o perfil demogr√°fico (idade, localiza√ß√£o, interesses, etc.): ")
    necessidades_expectativas = input("Quais s√£o as necessidades e expectativas dos usu√°rios?: ")
    linguagem_tom = input("Qual √© a linguagem e tom de voz adequados para o p√∫blico?: ")

    return {
        "perfil_demografico": perfil_demografico,
        "necessidades_expectativas": necessidades_expectativas,
        "linguagem_tom": linguagem_tom
    }

def main():
    """
    Fun√ß√£o principal para executar o script.
    """
    objetivo = definir_objetivo()
    detalhes_objetivo = detalhar_objetivo(objetivo) #Guarda os detalhes do objetivo
    publico_alvo = definir_publico_alvo()

    print("\nResumo da Defini√ß√£o do Projeto:")
    print(f"Objetivo Principal: {objetivo}")
    print(f"Detalhes do Objetivo: {detalhes_objetivo}") #Exibe os detalhes
    print(f"P√∫blico-alvo: {publico_alvo}")

if __name__ == "__main__":
    main()

!pip install -q google-adk

from google.adk.agents import Agent
from google.adk.runners import Runner
from google.adk.sessions import InMemorySessionService
from google.adk.tools import google_search
from google.genai import types  # Para criar conte√∫dos (Content e Part)
from datetime import date
import textwrap # Para formatar melhor a sa√≠da de texto
from IPython.display import display, Markdown # Para exibir texto formatado no Colab
import requests # Para fazer requisi√ß√µes HTTP
import warnings

warnings.filterwarnings("ignore")

def call_agent(agent: Agent, message_text: str) -> str:
    # Cria um servi√ßo de sess√£o em mem√≥ria
    session_service = InMemorySessionService()
    # Cria uma nova sess√£o (voc√™ pode personalizar os IDs conforme necess√°rio)
    session = session_service.create_session(app_name=agent.name, user_id="user1", session_id="session1")
    # Cria um Runner para o agente
    runner = Runner(agent=agent, app_name=agent.name, session_service=session_service)
    # Cria o conte√∫do da mensagem de entrada
    content = types.Content(role="user", parts=[types.Part(text=message_text)])

    final_response = ""
    # Itera assincronamente pelos eventos retornados durante a execu√ß√£o do agente
    for event in runner.run(user_id="user1", session_id="session1", new_message=content):
        if event.is_final_response():
          for part in event.content.parts:
            if part.text is not None:
              final_response += part.text
              final_response += "\n"
    return final_response

def to_markdown(text):
  text = text.replace('‚Ä¢', '  *')
  return Markdown(textwrap.indent(text, '> ', predicate=lambda _: True))

def definir_objetivo(topico, data_de_hoje):

    buscador = Agent(
        name="definir_objetivo",
        model="gemini-2.0-flash",
        instruction="""
        Voc√™ √© um assistente de pesquisa. A sua tarefa √© usar a ferramenta de busca do google (google_search)
        para recuperar as √∫ltimas not√≠cias de lan√ßamentos muito relevantes sobre o t√≥pico abaixo.
        stitu√≠do por outro que tenha mais.
        Qual ser√° a fun√ß√£o principal do seu chatbot?
1. Atendimento ao cliente (tirar d√∫vidas, resolver problemas)
2. Assistente virtual (agendar compromissos, fornecer informa√ß√µes)
3. Gera√ß√£o de leads (coletar informa√ß√µes de contato, qualificar clientes)
        """,
        description="Agente que busca informa√ß√µes no Google",
        tools=[google_search]
    )

    entrada_do_agente_buscador = f"T√≥pico: {topico}\nData de hoje: {data_de_hoje}"

    lancamentos = call_agent(buscador, entrada_do_agente_buscador)
    return lancamentos

def detalhar_objetivo(topico, lancamentos_buscados):
    planejador = Agent(
        name="detalhar_objetivo",
        model="gemini-2.0-flash",
        # Inserir as instru√ß√µes do Agente Planejador #################################################
        instruction="""
        Voc√™ √© um planejador de conte√∫do, especialista em redes sociais. Com base na lista de
        lan√ßamentos mais recentes e relevantes buscador, voc√™ deve:
        usar a ferramenta de busca do Google (google_search) para criar um plano sobre
        quais s√£o os pontos mais relevantes que poder√≠amos abordar em um post sobre
        cada um deles. Voc√™ tamb√©m pode usar o (google_search) para encontrar mais
        informa√ß√µes sobre os temas e aprofundar.
        Esta fun√ß√£o fornece mais detalhes e exemplos espec√≠ficos para o
    objetivo selecionado pelo usu√°rio.
        """,
        description="Agente que planeja posts",
        tools=[google_search]
    )

    entrada_do_agente_planejador = f"T√≥pico:{topico}\nLan√ßamentos buscados: {lancamentos_buscados}"
    # Executa o agente
    plano_do_post = call_agent(planejador, entrada_do_agente_planejador)
    return plano_do_post

def definir_publico_alvo(topico, plano_de_post):
    redator = Agent(
        name="definir_publico_alvo",
        model="gemini-2.0-flash",
        instruction="""
          Esta fun√ß√£o coleta informa√ß√µes sobre o p√∫blico que ir√° interagir
    com o chatbot, incluindo perfil demogr√°fico, necessidades e
    expectativas, e linguagem e tom de voz adequados
            Utilize o tema fornecido no plano de post e os pontos mais relevantes fornecidos e, com base nisso,
            escreva um rascunho de post para Instagram sobre o tema indicado.
            O post deve ser engajador, informativo, com linguagem simples e incluir 2 a 4 hashtags no final.
            """,
        description="Agente redator de posts engajadores para Instagram"
    )
    entrada_do_agente_redator = f"T√≥pico: {topico}\nPlano de post: {plano_de_post}"
    # Executa o agente
    rascunho = call_agent(redator, entrada_do_agente_redator)
    return rascunho

def main(topico, rascunho_gerado):
    revisor = Agent(
        name="main",


          model="gemini-2.0-flash",
          instruction="""
            Voc√™ √© um projetista que ira montar caixar para que o cliente possa fazer perguntas, voce usara o google_search para pesquisa,
            avera 3 opicoes de respostar acertivas,
           'O rascunho est√° √≥timo e pronto para publicar!'.
            Caso haja problemas, aponte-os e sugira melhorias.
            """,
        description="Agente revisor de post para redes sociais."
    )
    entrada_do_agente_revisor = f"T√≥pico: {topico}\nRascunho: {rascunho_gerado}"
    # Executa o agente
    texto_revisado = call_agent(revisor, entrada_do_agente_revisor)
    return texto_revisado

data_de_hoje = date.today().strftime("%d/%m/%Y")

print("üöÄ Iniciando o Sistema de Cria√ß√£o de Posts para Instagram com 4 Agentes üöÄ")

# --- Obter o T√≥pico do Usu√°rio ---
topico = input("‚ùì Por favor, digite o T√ìPICO sobre o qual voc√™ quer criar o post de tend√™ncias: ")

# Inserir l√≥gica do sistema de agentes ################################################
if not topico:
    print("Voc√™ esqueceu de digitar o t√≥pico!")
else:
    print(f"Maravilha! Vamos ent√£o criar o post sobre novidades em {topico}")

    lancamentos_buscados = definir_objetivo(topico, data_de_hoje)
    print("\n--- üìù Resultado do Agente 1 (Buscador) ---\n")
    display(to_markdown(lancamentos_buscados))
    print("--------------------------------------------------------------")

    plano_de_post = detalhar_objetivo(topico, lancamentos_buscados)
    print("\n--- üìù Resultado do Agente 2 (Planejador) ---\n")
    display(to_markdown(plano_de_post))
    print("--------------------------------------------------------------")

    rascunho_de_post = definir_publico_alvo(topico, plano_de_post)
    print("\n--- üìù Resultado do Agente 3 (Redator) ---\n")
    display(to_markdown(rascunho_de_post))
    print("--------------------------------------------------------------")

    post_final = main(topico, rascunho_de_post)
    print("\n--- üìù Resultado do Agente 4 (Revisor) ---\n")
    display(to_markdown(post_final))
    print("--------------------------------------------------------------")